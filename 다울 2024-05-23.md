---
title: 다울 2024-05-23
created: 2024-05-23 07:59
aliases: 
tags:
---
- [x] 나스 솔루션 link, source 백업하기 ✅ 2024-05-23
Yesterday: [[다울 2024-05-22]]
Tomorrow: [[다울 2024-05-24]]

## 오늘 작업 목표

- [x] AI 작업자 비교 시트에 수동편성 계획의 조체선료 표시 ✅ 2024-05-23
- [x] 잠금 조회 기능만 구현 ✅ 2024-05-23




## 배운 거
### LINQ 그룹바이를 사용하여 데이터를 그룹화할 때 주의해야 할 점

#### 데이터 구조 이해
데이터를 그룹화하기 전에 데이터의 구조를 잘 이해해야 합니다. 
데이터 유형과 관계를 파악하면 
그룹화 쿼리를 효과적으로 작성하는 데 도움이 됩니다.

#### 적절한 그룹화 키 사용
그룹화할 때 적절한 키를 선택하는 것이 중요합니다. 
키는 그룹화하려는 데이터의 필드나 필드 조합이어야 하며, 
논리적으로 의미가 있어야 합니다. 
잘못된 키를 사용하면 예상치 못한 결과가 나올 수 있습니다.

#### 널 값 처리
그룹화할 때 데이터에 널 값이 포함되어 있는지 고려해야 합니다. 
널 값이 있는 필드를 키로 사용하면 
의도치 않은 그룹이 생성될 수 있으므로 주의가 필요합니다.

#### 성능 고려
그룹화 작업은 
많은 데이터를 처리할 때 성능에 영향을 미칠 수 있습니다. 
가능하면 필요한 데이터만 미리 필터링하여 
그룹화 성능을 최적화해야 합니다.

#### 복잡한 키 사용 시 주의
여러 필드를 조합하여 복잡한 키를 사용할 때는 
각 필드의 값이 올바르게 결합되는지 확인해야 합니다. 
그렇지 않으면 원하는 대로 그룹화되지 않을 수 있습니다.

#### 익명 형식 사용
그룹화 결과를 처리할 때 익명 형식을 사용할 수 있습니다. 
익명 형식을 사용하면 쿼리 결과를 더욱 유연하게 처리할 수 있습니다.

#### 예외 처리
그룹화 과정에서 발생할 수 있는 예외 상황에 대비하여 
적절한 예외 처리를 구현해야 합니다. 
특히, 키가 없는 경우나 
데이터 형식이 맞지 않는 경우를 대비해야 합니다.

Q1: LINQ에서 여러 필드를 조합하여 그룹화를 수행할 때 유의해야 할 점은 무엇인가요?
Q2: 그룹화 쿼리를 최적화하기 위해 사용할 수 있는 기법은 어떤 것이 있나요?


## 정리가 필요한 메모


```sql
{ UPDATE TB_DOCK_PLAN2  SET MOVE = '1' , DT_START2 = '20240527'  , SHIFT_START2 = 'A'  , DT_END2 = '20240527'  , SHIFT_END2 = 'B'  , MW_CD2 = 'MW01'  , MW_NM2 = '1선석'  , MAKE_TYPE = '1'  , DT_UPDATE = NOW()  WHERE DW_SEQ = '1158' }
```

##### 확정기능에 대해서
확정은 order 테이블에서 decision을 1로 바꾸는 기능임
decision 1로 바꾸기
근데 만약 확정이 1인 기존 작업 말고 다른 plan을 확정한다면?

compare 테이블에서 보여주는 건
plan 테이블에 있는 전부
그래서 plan에 있고 order에도 있는 확정계획은 비교 표에 보이지

경우의 수를 나눠보자
ai worker x2, view 0 1 이니까 x2, decision 0 1이니까 x2 하면 경우의 수는 총 8 개네


case 0 기본
ai plan이 있고 worker plan이 있어. 그리고 order는 없어.
둘 중에 더 나은 걸 작업자가 확정.
그러면 order에 없는 레코드가 insert

case 0.1
worker를 확정했으면 ai는 어차피 view 0이니까 상관없는데

case 0.2
ai를 확정했으면? 그럼 worker가 view 1에서 0으로 바꾸고 ai를 다시 view 1로 update 해야하는거 아니야?

case 1
ai plan만 있어. worker는 없어. order도 당연히 없어.
작업자가 확정
레코드가 새로 insert

case 2
woker plan만 있어. order도 없어
작업자가 확정
레코드가 새로 insert

case 3
ai woker 둘다 있어. 근데 이미 ai order가 있고 작업자가 수정한 worker plan을 대신 확정하려고 해.
그럼 기존 order의 decision을 0으로 바꾸고
worker plan을 새로 insert

case 4
ai woker 둘다 있어. 근데 이미 ai order가 있고 작업자가 수정한 worker plan이 스케쥴에 보이는 상태.
다시 ai plan을 확정한다면 이미 order에 있는데 새로 insert하면 안되지
worker의 plan의 view를 0으로 업데이트 해야지
그리고 ai order의 decision을 1로 업데이트하고
ai plan의 view를 1로 업데이트하면 끝


case 5
ai 없고 기존 woker order가 있어. 이걸 수정하면?
order의 decision이 0이 되고 worker plan이 update 되나?
수정한 걸 다시 확정하면 이제 기존 order의 내용을 수정한 plan처럼 update해주고 decision을 1로 바꾸면 되겠지?



##### 조체선료 계산
허용시간 / 계약하역률 하면 허용시간인데 여기서 + 12 하면 턴타임 더해진 작업시간이고
이 작업시간이 SLOT Length 값 * 12 한 거고

조체선료 계산이 12시간 단위 근무표에서 되나?
조체선료는 시간 x 조출요율인데...
흠




##### 잠금 조회
```sql
"SELECT UW_SEQ, DT_WORK, SHIFT, GUBUN, MW_CD, UL_CD, DT_INSERT, DT_UPDATE FROM TB_UNLOAD_LOCK WHERE 1 = 1"

{ SELECT UW_SEQ      , DT_WORK      , SHIFT      , GUBUN      , MW_CD      , UL_CD      , DT_INSERT      , DT_UPDATE  FROM TB_UNLOAD_LOCK  WHERE 1=1 }
```