---
title: InteropServices.ExternalException
created: 2024-03-29 04:31
alias:
tags:
---
`System.Runtime.InteropServices.ExternalException: 'GDI+에서 일반 오류가 발생했습니다.'`는 
GDI+ 그래픽 인터페이스와 관련된 작업을 수행하다가 오류가 발생했을 때 나타날 수 있는 예외입니다. 
이 오류는 이미지 처리, 그래픽 드로잉, 파일로부터 이미지 로딩 등 GDI+를 사용하는 다양한 상황에서 발생할 수 있습니다. 
여러 원인이 있을 수 있으나, 일반적인 몇 가지 시나리오와 해결 방안을 살펴보겠습니다.

### 이미지 파일 처리 중 발생
###### 파일 접근 권한 또는 경로 문제
이미지 파일을 로드하려고 할 때 파일 경로가 잘못되었거나, 해당 파일에 접근할 권한이 없는 경우 오류가 발생할 수 있습니다. 
파일 경로를 정확히 지정했는지 확인하고, 애플리케이션이 파일에 접근할 수 있는 권한을 가지고 있는지 검사하세요.
###### 파일 손상
이미지 파일이 손상되어 GDI+에서 올바르게 처리할 수 없는 경우에도 이 오류가 발생할 수 있습니다. 
다른 이미지 파일로 테스트하여 문제가 파일 손상 때문인지 확인해 보세요.
###### 리소스 해제 누락
GDI+ 객체(예: `Bitmap`, `Graphics` 객체 등)를 사용한 후 적절히 해제하지 않으면, 리소스 누수로 인해 이 오류가 발생할 수 있습니다. 
`Dispose` 메서드를 호출하여 사용한 GDI+ 객체를 해제하세요.

### 그래픽 객체 사용 중 발생

###### 리소스 사용 제한 초과
GDI+ 리소스(예: 펜, 브러시, 이미지 등)의 사용 제한을 초과한 경우 
오류가 발생할 수 있습니다. 
사용이 끝난 리소스는 즉시 `Dispose` 메서드를 호출하여 해제하세요.

###### 멀티스레딩 문제
GDI+ 객체는 기본적으로 스레드에 안전하지 않습니다. 
따라서, 멀티스레딩 환경에서 GDI+ 객체를 사용할 때는 동기화를 적절히 처리해야 합니다.
###### 대용량 이미지 처리
매우 큰 이미지를 처리하려고 할 때 
메모리 부족 등의 문제로 인해 이 오류가 발생할 수 있습니다. 
이미지 처리 전략을 재검토하거나, 이미지 사이즈를 조절하여 문제를 완화할 수 있습니다.

### 일반적인 해결 방안
###### 예외의 상세 메시지 확인
`ExternalException`의 `Message` 속성을 통해 더 구체적인 오류 정보를 얻을 수 있습니다. 
이 정보는 문제의 원인을 좁히는 데 도움이 될 수 있습니다.
###### 디버깅 및 로깅
문제가 발생하는 코드 부분을 디버깅하거나, 오류 발생 직전의 상황을 로깅하여 문제의 원인을 분석할 수 있습니다.
###### 환경 검토
동일한 코드가 다른 환경(예: 다른 컴퓨터, 다른 운영 체제 버전 등)에서 정상적으로 작동하는지 확인하여, 
환경적인 요인을 배제해 볼 수 있습니다.

GDI+에서 발생하는 오류는 
때로는 애플리케이션의 로직이나 코드상의 문제보다는 환경적, 구성적 요인에 의해 발생하기도 합니다. 따라서, 다양한 각도에서 문제를 접근하고 검토하는 것이 중요합니다.


드래그에 givefeedback 이벤트를 주고 그 이벤트에서 마우스 커서 이미지를 생성하고 커서를 변경하는 과정에서 발생.
이미지 생성을 위해 
비트맵, 그래픽스 객체 생성을 빈번하게 하여서 발생한 에러라고 생각함
로드 시에 커서 객체를 미리 생성해두고 
필드에 저장된 커서 객체로 변경하도록 로직을 변경하여 해결함
