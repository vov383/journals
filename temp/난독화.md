---
title: 난독화
created: 2024-09-20 10:14
aliases: 
tags:
---
### 소스코드 난독화로 보호하는 방법

**소스코드 난독화**는 소프트웨어 보안을 강화하는 방법 중 하나. 
소스코드를 의도적으로 복잡하고 알아보기 어렵게 변형하여 
해커가 분석하거나 디컴파일을 통해 이해하는 것을 방지합니다. 
난독화된 코드는 그대로 실행되지만, 
사람이나 자동화된 도구가 코드 구조를 파악하기 어려움

#### 1. 소스코드 난독화 기법

##### 1.1 변수 및 함수 이름 변경
난독화의 가장 기본적인 방식은 변수, 함수, 클래스 이름 등을 의미 없는 이름으로 변경하는 것입니다. 
예를 들어, `CalculateTotal`이라는 함수명을 `a1`로 바꾸면, 코드의 의미를 해석하기가 훨씬 어려워집니다.

```csharp [wordwrap to 60 characters]
public class SalesCalculator
{
    public double CalculateTotal(double[] prices)
    {
        double total = 0;
        foreach (double price in prices)
        {
            total += price;
        }
        return total;
    }
}
```

난독화 후:

```csharp [wordwrap to 60 characters]
public class A
{
    public double a1(double[] a2)
    {
        double a3 = 0;
        foreach (double a4 in a2)
        {
            a3 += a4;
        }
        return a3;
    }
}
```

##### 1.2 제어 흐름 변조
코드의 제어 흐름을 복잡하게 만들거나 분할하여 
읽는 사람이 흐름을 쉽게 파악하지 못하게 하는 방법입니다. 
이는 특히 복잡한 논리 흐름을 가지고 있는 소스코드에 효과적입니다. 
조건문을 복잡하게 만들거나, 불필요한 조건을 추가해 분석이 어려워집니다.

```csharp [wordwrap to 60 characters]
public void ProcessOrder(int orderId)
{
    if (orderId > 0)
    {
        Console.WriteLine("Processing order: " + orderId);
    }
    else
    {
        Console.WriteLine("Invalid order.");
    }
}
```

난독화 후:

```csharp [wordwrap to 60 characters]
public void a1(int a2)
{
    if ((a2 & 1) == (a2 & 2))
    {
        if (a2 > 0)
        {
            Console.WriteLine("Processing order: " + a2);
        }
        else
        {
            Console.WriteLine("Invalid order.");
        }
    }
    else
    {
        Console.WriteLine("Something went wrong.");
    }
}
```

##### 1.3 문자열 암호화
코드 내에서 사용되는 모든 문자열을 암호화하여 
원본 문자열이 보이지 않도록 하는 방법입니다. 
디컴파일 후에도 문자열이 의미 없는 데이터로 표시되며, 
특정 조건이 충족되었을 때만 복호화되어 사용됩니다.

```csharp [wordwrap to 60 characters]
public string GetSecretKey()
{
    return "SECRET123";
}
```

난독화 후:

```csharp [wordwrap to 60 characters]
public string a1()
{
    byte[] encrypted = { 83, 69, 67, 82, 69, 84, 49, 50, 51 };
    string secret = Decrypt(encrypted);
    return secret;
}
```

##### 1.4 의미 없는 코드 삽입
난독화된 코드에 실제로 필요하지 않은, 
실행에 영향을 주지 않는 의미 없는 코드를 삽입하는 방법입니다. 
이는 코드 분석 시간을 늘리고, 분석 도구가 코드의 실제 흐름을 파악하는 것을 방해합니다.

```csharp
public void Calculate(int a, int b)
{
    int sum = a + b;
    Console.WriteLine("Sum: " + sum);
}
```

난독화 후:

```csharp
public void a1(int a2, int a3)
{
    int a4 = a2 + a3;
    for (int i = 0; i < 10; i++) {}  // 의미 없는 루프
    Console.WriteLine("Sum: " + a4);
}
```


#### 2. 난독화 도구
난독화를 수동으로 적용하기에는 시간이 많이 소요되기 때문에, 
대부분의 개발자는 **난독화 도구**를 사용합니다. 
다음은 대표적인 C# 난독화 도구들입니다.

- **Dotfuscator**: .NET 환경에서 사용되는 인기 있는 난독화 도구로, Visual Studio에 통합되어 있으며, 변수 및 메서드 이름 변경, 코드 흐름 보호, 문자열 암호화 등의 기능을 제공합니다.
- **ConfuserEx**: 무료로 제공되는 오픈소스 C# 난독화 도구로, 다양한 난독화 기법을 지원하며, 디컴파일러로부터의 분석을 어렵게 합니다.
- **SmartAssembly**: C#과 VB.NET을 위한 상용 난독화 도구로, 강력한 코드 난독화 및 디컴파일 보호 기능을 제공합니다.

#### 3. 난독화의 한계와 대응
난독화는 소스코드를 보호하는 데 강력한 도구지만, 완벽한 보안 솔루션은 아닙니다. 다음은 난독화의 한계와 이를 보완하는 방법입니다.

- **디컴파일 가능성**: 아무리 복잡하게 난독화된 코드도 디컴파일러를 사용하면 어느 정도 복구될 수 있습니다. 
- 이를 방지하려면 난독화와 함께 **실행 환경**에서 **DRM** 또는 **라이선스 관리**를 적용하는 것이 좋습니다.
- **성능 저하**: 복잡한 난독화는 코드 성능에 영향을 미칠 수 있습니다. 난독화의 복잡도를 조절하여 성능에 미치는 영향을 최소화하는 것이 중요합니다.
- **코드 유지보수**: 난독화된 코드는 사람이 읽기 어렵기 때문에 디버깅이나 유지보수가 어려워질 수 있습니다. 
- 소스코드의 원본을 안전하게 관리하고, 유지보수 시에는 난독화를 해제할 수 있는 환경을 구축해야 합니다.

#### 4. 난독화 적용 시 고려사항

- **적용 범위**: 전체 코드에 난독화를 적용할 필요는 없습니다. 
- 중요한 부분, 예를 들어 핵심 로직이나 민감한 데이터를 처리하는 부분에만 난독화를 적용하는 것이 효과적입니다.
- **테스트**: 난독화된 코드가 올바르게 작동하는지 철저히 테스트해야 합니다. 
- 특히, 제어 흐름이나 데이터 암호화와 관련된 문제를 중점적으로 확인해야 합니다.
- **지속적인 보안 업데이트**: 해커들은 난독화된 코드를 분석하는 방법을 끊임없이 발전시키므로, 
- 정기적인 난독화 업데이트 및 새로운 난독화 기법을 도입해야 합니다.

### 결론
**난독화**는 소스코드를 **역설계**하거나 **디컴파일**하는 것을 방지하는 유용한 기법입니다. 
**변수 이름 변경**, **제어 흐름 변조**, **문자열 암호화** 등 다양한 방법을 사용하여 코드의 가독성을 떨어뜨리고 분석을 어렵게 합니다. 
하지만, 난독화는 완벽한 방어책이 아니므로 **DRM**과 같은 추가 보안 방법과 병행하는 것이 좋습니다.

### 요약
1. **변수 및 함수 이름 변경**으로 코드 가독성 저하.
2. **제어 흐름 변조**로 코드를 복잡하게 만들어 분석 방해.
3. **문자열 암호화**로 중요한 데이터를 보호.
4. **의미 없는 코드 삽입**으로 디컴파일러를 혼란시킴.
5. **난독화 도구 사용**으로 자동화된 보호 적용.
6. **난독화의 한계**를 보완하기 위한 추가 보안 조치 필요.

Q1 : 소프트웨어 성능 저하를 최소화하면서 난독화를 적용할 수 있는 방법은 무엇일까?  
Q2 : 난독화와 함께 적용하면 보안이 더욱 강화되는 다른 기법은 무엇이 있을까?

