---
title: 소스 인수인계 관련
created: 2025-12-08 10:50
alias:
tags:
---
### 선석 하역계획 DB
#### tb_brand_unload
광종코드, 또는 광종타입과 광종코드의 .뒤에 있는 값과 선적국가에 따라
선석별로 하역률을 저장하고 있는 테이블
##### pk
BR_TYPE
BR_CD
COUNTRY
MW_NO

##### 특이사항
ABLE_TH 최종 하역률

입항예정정보의 대표광종을 기준으로 선박의 선적량을 어느 선석에서 작업하면 몇 시간이 걸리는지 계산하는데 사용한다.

입항예정정보의 대표광종이 이 테이블의 BR_CD 중에 있으면 일치하는 선석의 ABLE_TH 로 작업능력을 결정
대표광종이 이 테이블에 없다면 새로운 광종 CASE.
입항예정정보의 
광종타입, 
COAL 이나 SUB는 일괄적으로 N(New를 의미한다), ORE일 경우에만 광종코드의 . 뒤에 붙는 값 (가령 ROH.F 면 F)
선적국가 값을 활용해서 
`N_F_Austrailia` 처럼 `_`를 이용해서 3개를 연결한 값을 만든다.
이것과 일치하는 BR_TYPE, BR_CD 값을 활용해서 선석별 작업능력 값을 찾는다.



#### tb_comein_plan
해송적치계획 화면에서 조회하는 테이블
##### pk
WORK_KEY
공유플랫폼에서 데이터를 입력받을 때 부여. 
"YYYYMMDD-(시퀀스)" 포맷. FN_COM_KEY_X_DATA 로 생성됨.
##### 특이사항
입항예정정보와 다르게 항차년도 값이 없음.
선박명을 공유플랫폼에서 바로 받지 않음. 
	SH_CD와 SH_CHASU 를 갖고 `TB_PORT_ENTRY` 테이블의 선박명을 LEFT_JOIN 해서 가져온다.

#### tb_com_berth
선석정보.
현재 접안중인 선박에 관한 정보

##### pk
MW_CD

##### 특이사항
인터페이스에서 
SH_NM, SH_CD, SH_YEAR, SH_CHASU 넣어준다. 

작업중인 루트 정보를 최대 3개까지 나타내는 
`W{i}_RT_NO`
`W1{i}_YARD_CD`
`W{i}_YARD_NM`
(i는 1~3)

선석현황정보 화면에서 사용함. 현재 선석에서 사용중인 루트 정보.
루트정보 시트에서 루트번호 셀을 클릭하여 최적경로현황 화면으로 이동하여 루트 조회하는 기능

현재 인터페이스에서 WORK_KEY를 받을 수 없음.
그래서 선석작업현황 화면에서 `TB_DOCK_WORK와` `TB_UNLOAD_WORK` 의 현재 작업중 데이터도 들어오지 않음.


#### TB_COM_CODE
##### 선석, 하역작업 관련 CODE_TYPE
BRAND_TYPE,
UL_REPAIR_GROUP,
UL_REP_GUBUN,
UL_REP_INTER_GUBUN,
UL_STATUS,


#### TB_COM_SETUP
##### 선석, 하역작업 관련 ITEM_NAME
@@TB_UNLOAD_PLANINPUT.WORK_KEY,
@@TB_COMEIN_PLAN.WORK_KEY,
@@ai_timeout_sec_1001,
@@ai_work_date_1001,
@@efficient_index_item_1001, 
@@TB_DECISION_HIST.WORK_KEY,
ai_plan_time,
@@port_entry_val,
@@MONEY_EXCHANGE,


#### TB_COM_SHIP
##### PK 
SH_CD

##### 특이사항
선박코드 값으로 특정 선박의 이름과 제원 정보를 담고 있는 테이블
화면 로직에서 사용X


##### TB_COM_TASK
AI하역작업계획의 TASK_ID 는 1001


#### TB_COM_UNLOAD
하역기 정보 담고 있는 테이블

##### PK
UL_CD


##### 특이사항
MW_LIST 컬럼의 값이 해당 하역기가 작업하는 선석코드. 과거에는 하나의 하역기가 선석 2개를 모두 작업할 수 있다고 봤었기 때문에 
`MW01, MW02` 처럼 두 개의 선석을 넣을 수 있었지만 
현재는 하역기를 하나의 선석에 고정하여 사용하는 것으로 파악하여 
MW_LIST 컬럼에 선석이 하나만 들어있다.

UL_SEQ 값의 순서로 같은 선석에서 하역기의 순서가 배열됨.
UL_TYPE 1은 CSU, 2는 GTSU
UL_CD가 CSXX면 CSU, ULXX이면 GTSU
UL_WAY가 하역기 방향.

하역능력 관련된 컬럼들은 화면에서 사용X. 
과거 하역능력과 관련된 계산은 전부 `TB_BRAND_UNLOAD` 테이블의 광종별로 선석에서 작업능력 값을 사용하는 로직으로 변경되었다.
UL_POS는 선석작업현황 화면의 계류장치 번호와 매핑되는 값
TRAVEL_POS는 포스코의 스마트보드에서 하역기가 있는 위치의 X축 픽셀값

추후에 선석작업현황 화면에서 하역기 위치를 표시할 때 UL_POS를 사용해서 표시하는 로직을 추가할 수도

#### TB_DECISION_HIST
하역편성계획 확정이력

하역작업계획에서 AI, 조업자 편성 계획을 비교하는 시트에서 선택한 계획을 확정할 때 `TB_DOCK_ORDER2`에 데이터가 INSERT되면서 `TB_DECISION_HIST` 테이블에도 데이터가 입력된다.

##### PK
DH_SEQ
AUTO_INCREMENT로 자동으로 증하가는 값.

##### 특이사항
WORK_KEY는 확정 버튼으로 확정 기능을 실행할 때 KEY_X_DATA로 생성함. WORK_KEY가 같으면 확정 버튼을 클릭할 때 같이 확정되었음을 의미한다.
입항예정정보의 VESSEL_ID를 기준으로 하나의 선박에 AI, 조업자 편성 계획 각각 1개씩 2개의 계획이 있을 수 있고, AI단독, 조업자 편성 단독으로 있을 수도 있다.
SH_CD, SH_NM, SH_CHASU, VESSEL_ID 는 입항예정정보의 선박 정보

AI 편성의 작업계획 정보
MAKE_YN1
MW_CD1
MW_NM1
DW_TIME1
MONEY_EXPENSE1
EFFICIENT_INDEX1
DT_DW_START1
DT_DW_END1
BASE_RATE1

조업자 편성의 작업계획 정보
MAKE_YN2
MW_CD2
MW_NM2
DW_TIME2
MONEY_EXPENSE2
EFFICIENT_INDEX2
DT_DW_START2
DT_DW_END2
BASE_RATE2

DECISION_TYPE은 확정구분. 0, 1, 2 중에 하나.
0은 DOCK_PLAN으로 계획을 만들고 확정은 안 한 것.
1은 DOCK_PLAN으로 계획을 만들고 AI 편성을 확정
2는 DOCK_PLAN으로 계획을 만들고 조업자 편성을 확정

MAKE_YN 은 확정할 때 AI편성이나 조업자편성의 계획이 편성되어있었는지 여부를 표시
예시) MAKE_YN1 값이 1이고, MAKE_YN2 값이 0이면 AI 편성 계획만 있는 상태로 확정했다는 뜻.
둘다 1이면 둘다 편성한 상태에서 하나를 선택하여 확정했다는 뜻.

USER_ID 는 확정 버튼을 누른 조업자 아이디.

하역계획편성이력 화면에서 조업자 아이디를 사용해서 조업자 아이디와 일치하는 `TB_COM_USER`의 `USER_NAME`과 `USER_RANK`를 이름(직급) 포맷으로 표시한다.





#### TB_DOCK_PLAN2
선석계획 중 임시편성 단계. 
확정 전

##### PK
DW_SEQ
AUTO_INCREMENT 로 1씩 증가함.

##### 특이사항
DT_START와 SHIFT_START
하역작업계획 화면에서 스케줄표에 작업계획을 표시할 때 
하루를 4칸으로 나누어 00시, 06시, 12시, 18시로 시작시간을 표시
SHIFT 값은 1~4 까지. 
가령 2025-12-11 16시 18분이라는 시간을 스케줄표에서 찾을 때는
`20251211_3`으로 표시. 이 값이 작업계획의 FROM 값이 된다.

DT_END와 SHIFT_END
1~4까지 각각의 값은 6, 12, 18, 24 에서 -1을 뺀 값이 된다.
이 값이 작업계획의 TO 값이 된다.

MOVE 컬럼은 선석계획이 이안이 적용되었는지 여부 표시
0은 이안X, FROM TO가 한 개. 
1은 이안O, FROM TO가 두 개.
DT_START2, SHIFT_START2, DT_END2, SHIFT_END2
MW_CD2, MW_NM2 값이 있다.

SH_CD, SH_NM, SH_YEAR, SH_CHASU 값과 VESSEL_ID 는 입항예정정보의 선박에 관한 정보

DT_DW_START, DT_DW_END 는 작업시작시간과 작업종료시간을 정확하게 DATETIME 타입으로.

DW_TIME은 DT_DW_START 부터 DT_DW_END 까지의 시간을 INT 타입으로 저장

MONEY_EXPENSE 값은 조체선료. 조출료는 받는 돈이므로 - 로 입력.
체선료는 내야하는 돈이므로 +로 입력.

EFFICIENT_INDEX 값은 작업효율지수. 2024년도 인증 때 작업효율지수 값을 설정하는 로직이 있었는데 현재는 사용X. 
선석, 하역작업을 편성에 대한 평가는 조체선료(비용)을 갖고 평가한다.

MAKE_TYPE은 작업계획의 편성을 AI가 했는지, 조업자가 수동으로 했는지 여부. 

VIEW_FLAG 는 작업계획을 화면의 스케줄에 표시할지 말지 여부,
0은 미표시, 1은 표시

AI 편성 계획을 조업자가 수동으로 수정할 경우에 
VIEW_FLAG 값이 1 -> 0으로 변경되고, 선박 데이터를 가진 조업자 편성 계획 데이터를 새로 생성해서 TB_DOCK_PLAN2 테이블에 INSERT 한다.

AI, 조업자 편성 비교 시트의 선택 체크박스의 체크여부가 VIEW_FLAG 값과 연동되어 있음. 
조업자가 체크박스 체크 상태를 체크에서 언체크로 변경하면 VIEW_FLAG 값이 1 -> 0 으로 변경됨.
동일한 VESSEL_ID를 가진 선석작업계획은 AI편성 계획과 조업자 편성 계획을 1개씩만 가질 수 있고 하나를 선택하면 다른 하나는 VIEW_FLAG가 0이 되고 선택이 해제된다.

FIRST_YN은 우선접안 여부. 현재 사용X

BR_CD, BR_NM은 우선광종코드, 우선광종명인데 2024년도에는 특정선박과 특정광종에 대한 우선 기능이 있었는데 현재는 사용 X
현재는 입항예정정보의 EMG_YN 컬럼의 값이 Y면 우선배정하는 로직을 사용하여 작업계획을 편성한다.




#### TB_DOCK_ORDER2
선석계획 중 확정편성 단계. 
확정 후


##### PK
DW_SEQ
TB_DOCK_PLAN2의 DW_SEQ 값을 그대로 가져온다.
AUTO_INCREMENT 아님.



##### 특이사항
대부분의 컬럼이 TB_DOCK_PLAN2와 동일
다른 점은 DECISION 컬럼이 DOCK_PLAN의 VIEW_FLAG에 대응한다.
DECISION 값이 0이면 데이터가 들어있어도 화면에 표시X.

TB_DOCK_ORDER2 의 값을 조업자가 수동편성으로 수정할 때 DECISION 값을 1 -> 0 으로 변경하여 화면에서 숨기고
TB_DOCK_PLAN2에 해당 선박에 대한 정보를 가진 새로운 데이터를 INSERT 한다.

#### TB_DOCK_SHIFT
이접안 Shifting 계획

##### PK
SH_SEQ
AUTO_INCREMENT

##### 특이사항
접안 실적 데이터.
입항, 선박정보, 접안정보, 홀드정보, 야드 적치정보 등 종합하여 정보를 갖고 있음.

SH_TW 는 선적량 TON 단위로 되어 있는데 
인터페이스에서 KG 단위로 데이터가 들어온다.
화면에서 조회할 때 TON 단위로 표시하도록 조회하여 사용함.


DT_SH_ENTRY는 입항일시
DT_SH_DOCK은 접안일시
DT_SH_END는 출항일시

MONEY_EXCHANGE는 환율 정보
환욜이 1이면 국내선박임.
RATE_DISPATCH, RATE_DEMURRAGE 값은 조출요율, 체선요율
국내 선박이 아닌 경우에는 달러 단위로 표시되어 있기 때문에 환율값을 곱해주어야 비용 계산됨.
국내선박은 원화 기준임.

BRAND_GUBUN 컬럼의 값이 A~P 까지 있는데 TB_COM_CODE의 BRAND_TYPE 참고

DOCK_MW와 DOCK_DT는 예상접안 선석번호, 예상접안 일시

MOVE1_MW, MOVE1_DT
MOVE2_MW, MOVE2_DT
MOVE_OUT_DT
REDOCK_MW
REDOCK_DT
REDOCK_MOVE1_MW
REDOCK_MOVE1_DT
REDOCK_MOVE2_MW
REDOCK_MOVE2_DT

이 값들은 코멘트에 적힌대로 설계했는데 실제로 인터페이스에서 넣어줄 때 값을 어떻게 넣어주는지 파악X
현재 화면에서는 사용X

HOLD_BRAND1~11 까지는 홀드 1~11까지 들어있는 광종 코드
HOLD_UNLOAD_TON1~11은 홀드 1~11까지 들어있는 광종별 선적량 KG 단위

HOLD_LOAD_TON1~11 까지는 화면에서 사용X

YARD_BRAND1 ~ 4 까지 선박 브랜드 4개까지
YARD_BRAND1_INFO01 ~ 04 까지 브랜드 1개당 야드 파일 FROM, 파일 TO, 적치량 을 4개까지.
VARCHAR 타입으로 "H_0_0_20000" 포맷으로 입력됨.

VESSEL_ID로 이접안 실적의 선박과 TB_PORT_ENTRY의 선박이 일치하는지 찾는다.



#### TB_DOCK_WORK
접안작업상태정보

##### PK
DW_KEY

작업번호인데 현재 인터페이스에서 넣어주는 값 없음.
추후에 `TB_COM_BERTH`에 선박이 접안될 때 키 값을 생성해서 넣는 로직이 추가되면 사용할 수 있을듯.


##### 특이사항
스마트보드의 데이터를 표시하기 위한 목적으로 인터페이스로부터 데이터를 받는 테이블로 설계함.
SH_DOCK_POS 는 접안위치 계류장치 번호
SH_TURN_POS 는 선수방향(선박 머리) 0 왼쪽, 1 오른쪽
추후에 스마트보드로부터 이 데이터를 받을 수 있으면 표시할 수 있을듯.
현재는 화면에서 접안위치, 선수방향을 TB_DOCK_WORK 에서 조회하지 않고 접안위치는 선석별 기본값, 선수방향은 0을 기본값으로 사용.


#### TB_PORT_ENTRY

##### PK
VESSEL_ID 원료배선지시ID
과거에는 SH_CD, SH_YEAR, SH_CHASU 값을 PK로 사용했으나, 
조업에서 입항예정일자 정보를 볼 때 선박명 TBN150K, TBN180K, TBN200K와 같이 데이터가 입력된 날짜 기준으로 입항예정일이 많이 남은 선박의 경우 원료배선지시ID 와 정확하지 않은 선박 정보가 있는 경우가 있어서 SH_CD, SH_YEAR, SH_CHASU를 사용하여 고유한 선박을 알 수 없는 경우가 있어서 VESSEL_ID 값을 사용함.
VESSEL_ID값에 맞춰서 선박 데이터가 인터페이스로부터 입력, 수정됨.


##### 특이사항
SH_TW는 선적량 톤단위인데 인터페이스에서 KG 단위로 데이터가 들어오고 있음. 화면에서 조회할 때 KG 단위로 절삭해서 조회함.

BR_CD 는 선박의 대표광종. 대부분 광종 중에 가장 많이 실린 광종.

SH_GUBUN 은 계약타입, 

`UNLOAD_PORT`(양하항) 별로 턴타임 값(hour)
광양선     | 12
포항선     | 24
광양단독    | 18

`SH_GUBUN`(선박계약타입) 별로 텐더타임 값(HOUR)
S   | 36
D   | 00
P   | 00
C   | 36
V   | 00

`LOAD_COUNTRY`(선적국가) 가 Korea, Republic of 인 경우는 RATE_DISPATCH, RATE_DEMURRAGE 값의 크기 단위가 다름. 이 경우 원화로 조출요율, 체선요율 책정.
그 외에 다른 선적국가의 경우 달러 값이 들어온 것으로 본다.

`MONEY_EXCHANGE`(통화환율) 값은 NULL로 들어오는 경우가 많음. 
이때 값을 TB_COM_SETUP에 @@MONEY_EXCHANGE 에 넣어둔 값을 기본값으로 사용함. 현재 DB에 1430원으로 저장하였음.
TASK_1001에서도 B_COM_SETUP에 @@MONEY_EXCHANGE 값을 조회하여 비용 계산.

VENDOR_ITEM1 ~ PO_PARTIAL_NUM5 까지의 컬럼값은 사용하지 않음.

`BRAND_TYPE`(광종타입) 값은 철광석, 원료탄, 부원료 이렇게 3가지 구분만 사용함. 
TB_BRAND_UNLAOD 테이블의 BR_TYPE 값인 ORE, COAL, SUB에 대응.
철광석 -> ORE
원료탄 -> COAL
부원료 -> SUB

RMAT_SHIP_SLNG_DT ~ MW_NM 까지 사용X

`EMG_YN`(긴급하역 Y N)
이 값이 Y면 AI 편성 과정에서 이 선박을 다른 선박보다 우선하여 배정하도록 동작한다.

ITEM_CD_1 ~ 10
선박의 광종 종류
선적량이 많은 순서대로 1부터 저장됨.
보통 4개까지. MES에서는 최대 6개 까지 광종 종류가 있을 수 있음.
여분을 위해 10까지 컬럼을 준비한 것.

ITEM_BL_1 ~ 10
광종별 선적량 합계
KG 단위. 
화면에서는 톤 단위로 표시하므로 천 단위 절삭하여 조회.




#### TB_SHIP_HOLD
입항예정선박의 홀드정보를 따로 저장한 것

##### PK
VESSEL_ID, SH_HOLD
원료배선지시ID와 홀드번호가 PK

##### 특이사항
선박별로 최대 홀드 11개까지 올 수 있음.
인터페이스에서 SH_BL 값을 KG단위로 입력함.

#### TB_UNLOAD_LOCK
하역정비계획 테이블
하역작업계획 화면에서 잠금 토글을 ON한 상태에서 마우스 드래그로 선석에 설정함.


##### PK
UW_SEQ
AUTO_INCREMENT 적용

##### 특이사항
하역작업계획 화면의 스케줄표에서 조업자가 직접 선석에 잠금을 설정할 때 사용함.
AI 편성 TASK에서 이 정보를 금지선석 정보로 활용함

DT_WORK와 SHIFT를 조합하여 
"20250522_2" 포맷으로 스케줄에서 어느 컬럼에 들어가는지 찾는다.

예전에는 하역기에도 금지를 걸어서 하역작업계획 편성에 사용할 수 있게 하기 위해 GUBUN을 0이면 선석금지, 1이면 하역기 금지로 구분했지만 현재는 사용하지 않음.
UL_CD 컬럼도 마찬가지 이유로 사용하지 않음.

#### TB_UNLOAD_PLAN2
하역작업계획 임시편성
현재 사용X

#### TB_UNLOAD_ORDER2
하역작업계획 확정편성
현재 사용X





#### TB_UNLOAD_PLANINPUT
선석배정 AI TASK에 요청을 보낼 때 AI_TASK가 조회하는 데이터


##### PK
WORK_KEY,
VESSEL_ID


##### 특이사항
화면에서 버튼 클릭으로 TB_COM_TASK의 TASK_ID = '1001'인 레코드의 TASK_STATUS 를 0에서 1로 변경하면 TASK에서 2(처리중)으로 상태를 변경하고 이 테이블을 조회함.
TASK에 넘긴 PARAM은 WORK_KEY 값이고 이 WORK_KEY 값이 일치하는 레코드의 VESSEL_ID 값을 모두 조회하여 VESSEL_ID가 일치하는 선박정보를 입항예정정보에서 찾아서 편성한다.

SH_CD ~ MW_CD 컬럼의 값은 TASK_1001 로직에서 사용하지 않는다.



#### TB_UNLOAD_RATE
하역기하역기준율 정보
선석계획을 편성할 때 선석에 있는 특정 하역기에 대해 수리계획일정이 있는 경우에 선석의 하역능력을 몇 퍼센트 감소하여 적용할 것인지에 대한 정보를 담고 있는 테이블
가령 2선석의 CS04 하역기의 RATE_UNLOAD 값이 40 인데 이 하역기의 수리계획이 작업계획을 편성한 범위에 있으면
2선석의 TB_BRAND_UNLOAD에 정의된 어떤 광종에 대한 작업능력(T/H)의 60퍼센트만 적용하여 작업시간을 계산해야 한다.

##### PK
MW_CD
UL_CD


##### 특이사항
MW06에 있는 CS08, CS09, UL09 의 RATE_UNLOAD 값의 합이 40, 40, 30 이라서 100이 넘는데 이 부분은 추후에 확인을 해봐야함.

#### TB_UNLOAD_REPAIR
하역기 수리정비계획
하역기수리계획 화면에서 조회하는 테이블

##### PK
REP_SEQ : AUTO_INCREMENT 적용



##### 특이사항
REP_GUBUN, REP_GROUP, INTER_GUBUN 은 TB_COM_CODE에 정의된 값 사용.
REP_GUBUN은 P와 A로 구분. 
하역작업계획 화면에서 수리계획을 표시할 때 P는 보라색, A는 파란색으로 구분하여 표시



#### TB_UNLOAD_WORK
하역작업상태정보
스마트보드 정보

##### PK
UW_KEY
SH_HOLD

##### 특이사항
UW_KEY는 TB_DOCK_WORK의 DW_KEY 컬럼값과 함께 
`TB_COM_BERTH`에 있는 1~6선석의 WORK_KEY 컬럼값과 같으면 현재 작업중인 선박의 홀드정보와 매칭된다. 

인터페이스에서 값 넣어주는 기능이 현재 없음.

선석작업현황 화면에서 홀드 정보를 조회하는 시트에서 
원료야드현황 화면으로 이동, 최적경로현황 화면과 연계하는 기능
홀드에 대해 종단 야드 선택 기능,
홀드에 대해 사용 루트 선택 기능은 현재 사용 불가.
TB_COM_BERTH에 있는 선박과 WORK_KEY 값이 
TB_DOCK_WORK, TB_UNLOAD_WORK에 DW_KEY, UW_KEY 값이 일치하는 경우에만 화면에 버튼셀타입을 표시하고 일치하지 않으면 비어있는 일반셀로 표시하도록 함.

#### TB_YARD_STOCK
하역작업계획의 야드재고현황 버튼을 클릭하면 나오는 USERCONTROL의 기능
공장명, 광종명 콤보박스로 필터링 기능 추가함.



---

### 선석하역계획 화면

![[../../attachment/Pasted image 20251208135405.png]]


#### 선석작업현황
배경
	계류장치 번호
	수세장 표시
	선박그림
	하역기 그림
선석정보
	입항예정정보
	해송적치계획정보
	홀드정보
	실적정보
	루트정보
팝업버튼
	해송적치
	하역기수리계획
	메모

선석 배경과 선석정보의 데이터는 timer_tick2 이벤트를 통해 1초에 한 번 씩 갱신되도록 설정함.
데이터를 조회해서 db의 변경이 있을 경우에만 화면을 다시 갱신
변경이 없다고 판별되면 갱신x

##### up선석계획대비현황() 기본 생성자

1. `tb_com_code` 테이블에서 필요한 데이터를 가져와서 `_comCodeDns` 에 저장
2. `_statusLabels`, `_statusBitmaps`에 ul_status의 값 (0~10) 에 해당하는 code_value와 색상표시를 위한 bitmap 이미지를 딕셔너리로 저장
3. `_ucBerthInfos`에 1선석부터 6선석까지 선석정보를 담을 UserControl을 `List<ucBerthInfo>` 형태로 저장
4. 개별 `ucBerthInfo`에 시트의 주요 이벤트를 처리하는 `ucBerthInfoPresenter`를 초기화하고 
   각각 선석코드를 지정.


##### up선석계획대비현황_load 이벤트
1. `dock_pos_num()`을 통해 계류장치 번호 초기화
2. `ship_hold_num_interval_rightHead()`, `ship_hold_num_interval_leftHead()` 을 통해 선박 선수방향에 따른 선박의 계류장치 번호 초기화
3. `ship_weight()`를 통해 선박의 길이에 따른 선박 이미지의 width 설정
4. `GetComCodeData()` 를 통해 `tb_com_code`에 설정해둔 `UL_REP_GUBUN`값을 가져옴. (하역기정비 구분명)
5. `GetDtWorkShiftData()`를 통해 시스템시간의 `_dt_work`, `_shift` 값을 설정함. 예시 `20251209`, `2`
6. `GetBerthImages()`는 `Paint_ShipImage()`로 현황판 이미지를 draw하기 위해 필요한 그림을 미리 초기화 하는 기능
7. `setCursorArrow()`는 선석정보의 시트들에 마우스 커서를 기본 화살표 커서만 보이도록 설정하는 기능
8. `GetBerthInfoData_init()`은 현황판 정보를 표시하기 위해 필요한 초기 데이터를 조회하여 가져오는 기능 `_ds_entryInfo_New` 등
9. `SetData_BerthInfo()`는 조회한 데이터를 1~6선석까지 각각의 선석정보에 바인딩 할 수 있도록 `BerthInfoDto` 타입의 데이터 6개로 만드는 과정
10. `DataView_BerthInfo()`는 1~6선석까지 각각의 `BerthInfoDto`의 데이터를 `ucBerthInfo` userControl에 바인딩하는 기능
11. `DataView_UnloadRepairInfo()`는 하역기 수리계획을 조회하여 시스템 시간을 기준으로 **7일** 범위에 있는 수리계획이 있는 하역기명을 화면 하단에 표시하는 기능
12. `timer1_Tick` 이벤트를 통해 **1000ms** 마다 `RefreshData()` 실행
13. `RefreshData()`는 선석 그림을 표현하는 데이터, ucBerthInfo 컨트롤의 시트 데이터, 하역기 수리계획 데이터를 조회해서
    `RefreshDataSets()` 메서드를 실행. 낡은 `oldDataSet`에 기존 `newDataSet`에 담긴 데이터를 집어넣고, `newDataSet`에는 db에서 조회한 새로운 데이터를 집어넣음. 
    old 와 new 둘다 데이터가 존재하는지 여부를 체크하고 두 데이터가 동일한지 여부를 체크해서 db에서 조회한 데이터가 달라졌다면 화면에 반영함.
14. `Refresh_WorkStateDrawPanel()`는 선석현황 그림을 리프레시 하는 역할. `pan_workStatusDraw.Invalidate();`를 통해 `pan_workStatusDraw_Paint` 이벤트를 호출
15. `pan_workStatusDraw_Paint` 이벤트는 5단계로 구성
    1. `Paint_Background(sender, e)`; // 배경 그리기
	2. `PaintMooringNum(e)`; // 계류장치 번호 그리기
	3. `GetData_DockUnloadPaint()`; // 데이터 가져오기. 
	   선박과 하역기를 그리기 위해 필요한 데이터를 가공해서 `_berthPaintDnList`에 `Dictionary<string, object>` 타입으로 저장
	4. `Paint_ShipImages(_berthPaintDnList, e)`; // 선박 이미지 적용
	5. `Paint_OneShipImage(e, dockDn)' // 단일 선박 이미지 그리기
	6. `Paint_UnloadImage3(_comUlDnListForPaint , _unloadPaintDnList, e)`; // 하역기 이미지 그리기
	   분기1. gtsu 인지 csu 인지에 따라 이미지 선택
	   분기2. 하역기 각도에 따라 90, 65, 135도 이미지 선택
	   분기3. 작업중인 하역기와 작업X 하역기
		   작업중인 하역기는 하역기 홀드번호에 따라 x좌표 위치 결정
		   작업x 하역기는 `tb_com_unload` 테이블의 ul_pos 컬럼 값에 따라 x좌표 위치 결정.
	   분기4. ulNm(하역기명)의 Length 값에 따라 x좌표 위치 결정
	   

###### Paint_OneShipImage(e, dockDn) 메서드 설명
`Paint_OneShipImage(e, dockDn)` // 개별선박 그리기 실행.
초기 설정 및 리소스 준비
- **폰트 및 브러시:** 선박 명칭 표시를 위한 폰트(`FontBerthImageShipName`)와 색상(`BerthImageShNmForeColor`) 로드.
- **이미지 제원 상수:** 
	- 선박의 머리(Head), 몸통(Body), 꼬리(Tail)의 너비와 높이, Y축 좌표 등을 상수값으로 정의.
- **유격 보정:** 
	- 이미지 간 연결 부위의 자연스러운 렌더링을 위해 `pixelForImageGap` 변수를 사용하여 X축 좌표 미세 조정.
	- `dockDn` (Dictionary)에서 선박 정보를 추출.
- **필수 데이터:**
	- `SH_NM`: 선박명 (Null일 경우 렌더링 중단)
	- `HOLD_COUNT`: 선박 크기 결정 (Null일 경우 기본값 5)
	- `SH_DOCK_POS`: 계류 장치 번호
	- `SH_TURN_POS`: 접안 방향 (0: 정방향, 1: 역방향)
- 기본값 처리 로직
	- `SH_DOCK_POS`(선석 위치) 데이터가 부재할 경우, `MW_NM`(선석 구역 명칭)을 기준으로 기본 계류 장치 번호를 강제 할당함.
		- 1선석 → 8번
		- 2선석 → 16번
		- 3선석 → 28번
		- 4선석 → 41번
		- 5선석 → 51번
		- 6선석 → 2번
	- 선박 이미지의 색상을 결정
		- 1 ~ 3: Black
		- 4 ~ 6: Green (기본값)
		- 7 ~ 9: Orange
		- 10 ~ 11: Red
		- 그 외: Green
- 좌표계산 및 렌더링
	- 전역 변수 `_dock_num_list` (계류 장치별 X 좌표 배열)를 순회하며 실제 그려질 위치를 계산함.
	- **방향 처리 (`SH_TURN_POS`):**
		- `0`: 정방향 렌더링 (Head → Body → Tail)
		- `1`: 역방향 렌더링. `RotateNoneFlipX`를 사용하여 이미지를 좌우 반전시키고, 그리기 순서를 조정함 (Tail → Body → Head).
	- **좌표 매핑 로직:**
		- 선석 구분(1~3선석 vs 4~6선석) 및 계류 장치 번호(`j`)의 범위에 따라 배열 인덱스를 다르게 계산함.
		- 특히 `j >= 7` 조건과 `mwNum >= 4` 조건을 복합적으로 사용하여 1선석과 6선석 간의 계류 장치 번호 중복 문제를 처리함
	- **좌표 배열 인덱싱 주의:** 
		- `_dock_num_list.Length - 17 + j` 와 같은 형태의 하드코딩된 인덱스 계산식이 존재하므로 UI 수정 시 반드시 검증 필요

###### 주요변수 설명

| **변수명**             | **타입**                       | **설명**                          | **비고**        |
| ------------------- | ---------------------------- | ------------------------------- | ------------- |
| `dockDn`            | `Dictionary<string, object>` | 선박 정보 및 접안 정보가 담긴 데이터셋          | 필수 파라미터       |
| `mwNum`             | `int`                        | 선석 구역 번호 (MW_NM 기반 변환)          | 1~6 선석 구분용    |
| `shipColorIndex`    | `int`                        | 선박 이미지 리소스 인덱스                  | Hold 수에 따라 결정 |
| `_dock_num_list`    | `Array`                      | 계류 장치별 화면 X 좌표를 담고 있는 전역 배열     | 좌표 매핑의 기준     |
| `_ship_weight_list` | `Array`                      | Hold 수에 따른 선박 몸통(Body) 길이 정의 배열 | 동적 길이 조정용     |

하역기(Unloader)의 상태, 종류, 작업 여부에 따른 이미지 렌더링 로직과 좌표 계산 방식을 설명하는 데 중점을 두었습니다.

###### Paint_UnloadImage3 메서드 설명

하역기(CSU, GTSU 등)의 실시간 상태를 시각화하는 기능을 수행함. 
`PaintEventArgs`를 통해 GDI+ 환경에서 그려지며, 하역기의 종류, 
붐(Boom)의 각도(`UL_WAY`), 작업 상태(`UL_STATUS`), 그리고 선박과의 연동 위치를 계산하여 화면의 정확한 좌표에 이미지를 출력함.

## 2. 상세 프로세스 분석

### 2.1. 리소스 초기화 및 하역기 식별

- **하역기 종류 판별:**
    - `UL_NM`(하역기 명칭)에 "GTSU"가 포함된 경우 별도의 GTSU 이미지를 사용함.
    - 그 외의 경우 일반 CSU 이미지를 사용하며, `UL_WAY`(각도: 90, 65, 135도)에 따라 `flp_ulImg` 컨테이너에서 적절한 이미지를 가져옴.
        
- **상태 아이콘 설정:**
    - `UL_STATUS` 값에 따라 `_statusBitmaps` 배열에서 상태(작업 중, 대기, 고장 등)를 나타내는 비트맵 아이콘을 로드함.

### 2.2. 좌표 계산 로직 (핵심)

하역기의 X축 좌표(`unload_X_pos`)는 
하역기가 현재 **'선박 작업 중'** 인지 **'대기 중'** 인지에 따라 서로 다른 로직으로 계산됨.

#### 2.2.1. 선박 작업 중일 경우 (Working Mode)

`dockDnList`(선박/접안 정보)와 `UL_NM`이 일치하는 경우, 
선박의 홀드(Hold) 위치를 기준으로 좌표를 산출함.

- **기준점:** 선박의 `HOLD_START_X`를 기준으로 함.
- **방향 보정 (`SH_TURN_POS`):**
    - **역방향(1):** 선박이 반대로 접안된 경우, `holdCount`에서 `sh_hold_num`까지 역순으로 `_ship_rightHead_num_list`의 너비를 합산하여 위치를 잡음. 
      추가 보정값(`pixelAddIfTurnPosRight = -15`) 적용.
    - **정방향(0):** `sh_hold_num`까지 `_ship_leftHead_num_list`의 너비를 순차적으로 합산.
        
#### 2.2.2. 대기 또는 이동 중일 경우 (Idle Mode)

선박 정보와 매칭되지 않는 경우, 
하역기 자체의 위치 정보(`UL_POS`)와 선석 정보(`MW_LIST`)를 기반으로 고정된 계류장치 좌표(`_dock_num_list`)를 참조함.

- **MW06 (6선석 구역):**
    - `UL_POS`가 2~17 또는 1(MW05 포함 시)인 경우: `_dock_num_list` 인덱스에 +50 또는 +52를 더해 좌표 매핑.
        
- **그 외 (1~5선석):**
    - `UL_POS` 8~58 범위: `_dock_num_list` 인덱스에서 -8을 하여 좌표 매핑.

### 2.3. 그래픽 드로잉 (Rendering)

계산된 `unload_X_pos`를 기준으로 다음 세 가지 요소를 순차적으로 그림. 
`UL_WAY`(각도)에 따라 X축 오프셋(Offset)을 미세 조정하여 그리는 코드가 분기되어 있음.

1. **하역기 본체:** `unloadImg` (CSU/GTSU 이미지)
2. **하역기 명칭:** `unloadNameBox` (배경 박스) + `DrawString` (텍스트)
3. **상태 이미지:** `ulStatusImage` (우측 하단 상태 표시)
    
## 3. 주요 변수 설명

| **변수명**                  | **타입**             | **설명**                  | **비고**     |
| ------------------------ | ------------------ | ----------------------- | ---------- |
| `comUlDnList`            | `List<Dictionary>` | 전체 하역기 데이터 리스트          | 루프 대상      |
| `dockDnList`             | `List<Dictionary>` | 현재 접안 중인 선박 및 작업 정보 리스트 | 작업 위치 매칭용  |
| `pixelAddIfTurnPosRight` | `int`              | 선박 역방향 접안 시 X좌표 보정값     | 상수 (-15)   |
| `ulWay`                  | `int`              | 하역기 붐 각도 (90, 65, 135)  | 이미지 선택 기준  |
| `unload_X_pos`           | `float`            | 계산된 최종 출력 X 좌표          | 로직의 핵심 결과값 |


---

### <요약>

- **기능:** 하역기(CSU, GTSU)의 종류, 각도, 상태를 그래픽으로 표현.
- **핵심 로직:** 하역기가 '작업 중'일 때는 선박의 홀드 위치를 따라가고, '대기 중'일 때는 선석의 계류장치 번호를 따라가는 이원화된 좌표 계산 방식을 사용.
- **주의사항:** 선박 역방향(`turn_pos == "1"`) 계산 로직과 6선석(`MW06`) 좌표 매핑 로직이 복잡함. 수정 시 주의.


#### 하역작업계획
입항예정정보
입항예정선박목록
목록에서 선박을 선택하면 해당 선박의 상세 정보 조회 가능

단일선박 상세정보
단일선박 광종별 선적량 정보
단일선박 선석별 예상 작업시간 정보



##### ai편성요청 팝업
입항예정정보 조회
선박명, 광종명, 입항예정일자로 필터링
단일선박 등록 버튼 클릭으로 선택 선박 ai 편성목록에 추가
더블클릭으로 동일한 기능
하역진행구분이 입항예정인 선박은 색상 표시
ai 편성목록에 선박 추가하면 색상 표시
ai 편성목록에서 삭제 버튼 클릭으로 선택 선박 ai 편성목록에서 제외
더블클릭으로 동일한 기능
초기화 버튼으로 ai 편성목록 전체 선박 제외
입항예정등록 버튼으로 하역진행구분이 입항예정인 선박 전부 ai 편성목록에 추가
편성요청 버튼 클릭하여 ai 편성 기능 실행

작업계획 초기화



조회 기준 날짜 변경
time_base 값을 기준으로 -1 ~ + 6 까지 7일 범위 조회
일주일 전
하루 전
오늘
날짜선택
다음 날
다음 주

작업계획 조회



야드재고현황버튼
###### 야드재고현황 패널
단순 조회 기능
공장별, 광종멸 필터링 기능

브랜드별하역율팝업 버튼
##### 브랜드별하역율팝업
품종구분, 나라, 브랜드명 필터링 기능
조회, 등록, 수정, 삭제 기능
등록 버튼을 클릭하여 등록 기능 실행
수정 버튼 클릭하여 선택된 행의 정보 수정 패널 실행
삭제 버튼 클릭하여 선택된 행의 정보 삭제 실행
엑셀 내보내기 기능

하역기하역기준율 팝업 버튼
##### 하역기하역기준율 팝업
조회, 등록, 수정, 삭제 기능
등록 버튼을 클릭하여 등록 기능 실행
수정 버튼 클릭하여 선택된 행의 정보 수정 패널 실행
삭제 버튼 클릭하여 선택된 행의 정보 삭제 실행
엑셀 내보내기 기능



ai, 조업자 편성 계획 비교 시트
선박명 클릭 시 해당 작업계획 날짜로 이동
선택 컬럼의 체크박스로 작업계획의 일정표 표시 여부 변경
동일한 배선지시ID의 선박에 대해 ai, 조업자 계획 중 하나만 선택 가능

작업계획의 선택된 계획들의 총비용이 계산되고
확정 버튼을 통해 작업계획을 확정시킬 수 있음.

확정이력 버튼을 통해 하역계획편성이력 화면으로 이동 가능


#### 해송적치계획
조회성 화면
날짜 기준으로.
선박명, 광종명으로 필터링
엑셀 내보내기 기능


#### 하역기수리계획
조회성 화면
날짜 기준으로
하역기, 주요부명, 정비구분명, 정비종류, 내역으로 필터링
엑셀 내보내기 기능


#### 하역작업편성이력
조회성 화면
날짜 기준으로
선박명, 자동편성, 수동편성, 확정여부로 필터링 가능
엑셀 내보내기 기능



[[../../noGitSync/cd/up하역작업계획_analysis|up하역작업계획_analysis]]
[[../../noGitSync/cd/PortEntryPresenter_analysis|PortEntryPresenter_analysis]]
[[../../noGitSync/cd/BerthScheduleViewModel_analysis|BerthScheduleViewModel_analysis]]
[[../../noGitSync/cd/BerthScheduleDrawer_analysis|BerthScheduleDrawer_analysis]]



[[../../noGitSync/cd/class_relationships|class_relationships]]
[[../../noGitSync/cd/command_pattern_analysis|command_pattern_analysis]]



[[../../noGitSync/cd/up입항예정정보_analysis|up입항예정정보_analysis]]



[[../../noGitSync/cd/up선석계획대비현황_analysis|up선석계획대비현황_analysis]]



[[../../noGitSync/cd/up하역기수리계획_analysis|up하역기수리계획_analysis]]




[[../../noGitSync/cd/Sql하역관리|Sql하역관리]]
[[../../noGitSync/cd/Sql하역계획편성이력|Sql하역계획편성이력]]
[[../../noGitSync/cd/Sql해송적치계획|Sql해송적치계획]]



[[../../noGitSync/cd/task_1001_로직설명]]
[[../../noGitSync/cd/AI_Berth_Alloc_Predict_Analysis]]



